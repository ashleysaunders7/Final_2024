---
title: "Covid91 vaccine study Final2024"
author: "Ashley Saunders"
output: 
  html_document:
    number_sections: true
    toc: true
    toc_depth: 5
date: "`r Sys.Date()`" 
---

```{r include=FALSE,echo=FALSE}
require(tidyverse)
require(tigerstats)
require(forcats)
OldData <-read.csv(file="finalSumr2024.csv",header=TRUE)
#recode to remove the annoying "X" from the dataframe
FinalData <- OldData %>% mutate(infected = recode(infected, covid19 = "covid", none = "OK" )) %>% select(-one_of("X"))
FinalData <- FinalData %>%
mutate(across(where(is.character), as.factor))
FinalData$treatment <- relevel(FinalData$treatment,ref="placebo")
#FinalData$infected <- relevel(FinalData$infected,ref="OK")
Male = filter(FinalData, sex =="M")
Female = filter(FinalData, sex =="F")
Gay = filter(FinalData, LGBTQ =="gay")
DrugUser = filter(FinalData, DrugUser =="yes")
```

# Introduction

A new  preventative vaccine (covid921) is under test in clinical trials. Given the nature of this vaccine it is suspected that the drug may exhibit different effectiveness across the variety of subpopulations tracked. Consider population subgroups by gender( guys and gals), drug use, and sexual orientation. Write a complete report that separately considers this drug for each subgroup and your recommendations as to whether people in the subgroup should take the vaccine. Structure your report in four sections each devoted to one of the four subgroups, use null and alternative hypothesis statements and correct statistical verbage when referencing p-values in conclusions.

## Overall approach

1. **Descriptive Analysis**: Summarize data perceptibly then numerically.
2. **Inferential Analysis**: Perform hypothesis testing:
   - \(H_0\): The vaccine has no impact on infection rates.
   - \(H_A\): The vaccine reduces infection rates.
3. **Effectiveness Calculation**:
   \[
   \text{Vaccine Effectiveness (VE)} = 1 - \frac{\text{Risk}_{\text{vaccine}}}{\text{Risk}_{\text{placebo}}}
   \]
4. **Effectivness Confidence Interval**: low to high

## Males

### Summary of Males
```{r}
male_summary <- Male %>%
  group_by(treatment, infected) %>%
  summarise(count = n(), .groups = "drop") %>%
  pivot_wider(names_from = infected, values_from = count, values_fill = 0)
male_summary <- male_summary %>%
  mutate(total = rowSums(select(., -treatment)))
male_column_totals <- male_summary %>%
  summarise(across(where(is.numeric), sum)) %>%
  mutate(treatment = "Total")
male_summary <- bind_rows(male_summary, male_column_totals)
male_summary
```

For men, this is the information that has been provided at this point. 18392 men are present. 18037 are acceptable but 355 have COVID. Let's add a barplot for a visual depiction since this is insufficient to demonstrate a trend.

### Visual Results
```{r}
# Bar plot

# Summarize the data for Males by infection status and treatment
male_summary_data <- Male %>%
  group_by(infected, treatment) %>%
  summarize(count = n(), .groups = "drop") %>%
  mutate(prcnt = count / sum(count))

# Bar plot for count of infected vs treatment
male_plot_count <- ggplot(male_summary_data, aes(x = infected, y = count, fill = treatment))
male_plot_count + 
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Number of Males Infected by Treatment",
       x = "Infection Status", y = "Count of Infected Males") +
  scale_fill_manual(values = c("placebo" = "gray", "vaccine" = "blue")) +
  theme_minimal()

# Bar plot for percentage of infected vs treatment
male_plot_percent <- ggplot(male_summary_data, aes(x = infected, y = prcnt * 100, fill = treatment))
male_plot_percent + 
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Percentage of Males Infected by Treatment",
       x = "Infection Status", y = "Percentage of Infected Males") +
  scale_fill_manual(values = c("placebo" = "gray", "vaccine" = "blue")) +
  theme_minimal()
```

The number of males infected with COVID-19 is displayed in the barplots above. On both graphs, the findings are comparable to the placebo, but visually, males who receive the immunization have lower COVID than the placebo. They still differ visually, but in order to determine whether the difference is significant, we must perform a statistical study.

### Numerical Results
```{r}
table1 <- xtabs(~infected + treatment, data=Male)
rowPerc(table1)
colPerc(table1)
```

According to the numerical data, 73.8% of the diseased males had received the placebo, whereas 26.2% had received the vaccine. 49.99% had received the vaccine, and 50.01% had received the placebo for those who are acceptable. Overall, compared to 1.02% of males receiving the vaccine, 2.82% of guys receiving the placebo had COVID, suggesting that the immunization lowers infection rates. These results imply that the immunization is successful in reducing COVID-19 in males. This allows us to correlate it to the barplots that demonstrate its success.

### Inferential Results
```{r}
chisq.test(table1)
chisqtestGC(table1)
Malefish <- fisher.test(table1)
Malefish
```

Fisher's Exact Test yields a very small p-value, 0.00000000000000022, which is the main result to pay attention to. This indicates that it is highly improbable that the observed variations in infection rates between the vaccine and placebo groups happened by accident. We reject the null hypothesis, which holds that infection rates are unaffected by therapy. Males who received the vaccine had an approximately 2.8-fold higher risk of contracting COVID-19 than those who received a placebo, as indicated by the odds ratio of roughly 2.82. These findings suggest that the immunization has little effect on preventing COVID-19 in men.

```{r}
# Calculate effectiveness
male_effect <- Malefish$p.value / (Malefish$p.value + 1)
effectiveness_male <- (1 - 1 / Malefish$estimate) * 100
print(effectiveness_male)

# Calculate effectiveness confidence interval
male_low <- (1 - 1 / Malefish$conf.int[1]) * 100
male_hi <- (1 - 1 / Malefish$conf.int[2]) * 100
options(digits = 2)

#print 
male_low
male_hi
```

### `r effectiveness_male`% Effectiveness with Confidence Interval: `r male_low`%  to `r male_hi`%

The COVID-19 vaccine for men is effective, with an efficacy of 64.48%, which is above the 50% threshold for success. The confidence interval ranges from 54.75% to 72.32%, further supporting its effectiveness in reducing infection rates among males. The null hypothesis (no effect) is rejected, and the alternative hypothesis (vaccine lowers infection rates) is accepted, based on the low p-value from Fisher's Exact Test and an odds ratio of 2.82. This means vaccinated men are nearly 2.8 times more likely to avoid COVID-19 compared to those who received a placebo. The confidence interval further confirms the vaccine’s strong protective effect.

## Females

### Summary of Females
```{r}
female_summary <- Female %>%
  group_by(treatment, infected) %>%
  summarise(count = n(), .groups = "drop") %>%
  pivot_wider(names_from = infected, values_from = count, values_fill = 0)
female_summary <- female_summary %>%
  mutate(total = rowSums(select(., -treatment)))
female_column_totals <- female_summary %>%
  summarise(across(where(is.numeric), sum)) %>%
  mutate(treatment = "Total")
female_summary <- bind_rows(female_summary, female_column_totals)
female_summary
```

For the women, here is the information that has been provided thus far. The number of females is 18328. While 17963 are okay, 365 have COVID. Since this is insufficient to demonstrate a trend, let's now include a barplot for a visual aid.

### Visual Results
```{r}
# Bar plot

# Summarize the data for Females by infection status and treatment
female_summary_data <- Female %>%
  group_by(infected, treatment) %>%
  summarize(count = n(), .groups = "drop") %>%
  mutate(prcnt = count / sum(count))

# Bar plot for count of infected vs treatment
female_plot_count <- ggplot(female_summary_data, aes(x = infected, y = count, fill = treatment))
female_plot_count + 
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Number of Females Infected by Treatment",
       x = "Infection Status", y = "Count of Infected Females") +
  scale_fill_manual(values = c("placebo" = "gray", "vaccine" = "blue")) +
  theme_minimal()

# Bar plot for percentage of infected vs treatment
female_plot_percent <- ggplot(female_summary_data, aes(x = infected, y = prcnt * 100, fill = treatment))
female_plot_percent + 
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Percentage of Females Infected by Treatment",
       x = "Infection Status", y = "Percentage of Infected Females") +
  scale_fill_manual(values = c("placebo" = "gray", "vaccine" = "blue")) +
  theme_minimal()
```

The number of females infected with COVID-19 is displayed in the barplots above. On both graphs, the results are comparable to the placebo, but visually, females who receive the immunization have lower COVID than the placebo. They still differ visually, but in order to determine whether the difference is significant, we must perform a statistical study.

## LGBTQ




## Druggies


# Overall Results and Conclusions